
- name: Clone Video-streaming-app repository
  git:
    repo: "{{ repo_url }}"
    dest: "{{ git_clone_dest }}"
    update: yes

- name: Debug synchronize variables
  debug:
    msg:
      - "Synchronize src: {{ synchronize_src }}"
      - "Synchronize dest: {{ synchronize_dest }}"
      - "Rsync opts: --ignore-existing, --exclude={{ synchronize_src }}/src/node_modules/"

- name: Move the rest of the files, but skip node_modules
  tags: sync_files
  synchronize:
    src: "{{ synchronize_src }}"
    dest: "{{ synchronize_dest }}"
    recursive: yes
    rsync_opts:
      - "--ignore-existing"
      - "--exclude={{ synchronize_src }}/src/node_modules/"

- name: Set working directory fact
  set_fact:
    working_dir: "{{ git_clone_dest }}"

